# Database Documentation

This directory contains automatically generated database schema documentation.

## Files

- **`database-schema.md`** - Complete schema documentation with tables, columns, constraints, and relationships
- **`database-er-diagram.mmd`** - Mermaid ER diagram source
- **`database-er-diagram.png`** - ER diagram as PNG image (generated in CI)
- **`database-er-diagram.svg`** - ER diagram as SVG image (generated in CI)

## How It Works

The database documentation is automatically generated by GitHub Actions on every commit to `main` that modifies migration files.

### Workflow

1. **Trigger**: Push to `main` with changes in `src/main/resources/db/migration/**`
2. **Setup**: PostgreSQL container started, Flyway migrations executed
3. **Generation**:
   - Schema documentation extracted from live database
   - Mermaid ER diagram generated from schema metadata
   - PNG and SVG images created from Mermaid source
4. **Commit**: Updated documentation committed back to repository

### Manual Generation

You can generate documentation locally:

```bash
# Ensure PostgreSQL is running
docker-compose up -d postgres

# Generate schema documentation
PGHOST=localhost PGPORT=5432 PGDATABASE=costify PGUSER=postgres PGPASSWORD=postgres \
  ./scripts/generate-schema-docs.sh

# Generate ER diagram (requires mermaid-cli)
PGHOST=localhost PGPORT=5432 PGDATABASE=costify PGUSER=postgres PGPASSWORD=postgres \
  ./scripts/generate-er-diagram.sh
```

### Install Mermaid CLI (for PNG/SVG generation)

```bash
npm install -g @mermaid-js/mermaid-cli
```

## Viewing Diagrams

### In GitHub
The Mermaid diagram is rendered natively in GitHub markdown viewers.

### Locally
- View PNG/SVG images in any image viewer
- View Mermaid source in `database-er-diagram.mmd`
- Render Mermaid in VS Code with extensions like "Markdown Preview Mermaid Support"

## CI Pipeline

The documentation pipeline runs in `.github/workflows/database-schema-docs.yml` and:
- Uses Java 25 and Maven for migrations
- Spins up PostgreSQL 16 for schema extraction
- Installs Mermaid CLI for diagram generation
- Commits results with `[skip ci]` to avoid infinite loops
