# Database Documentation

This directory contains automatically generated database schema documentation.

## Files

- **`database-schema.md`** - Complete schema documentation with tables, columns, constraints, and relationships
- **`database-er-diagram.mmd`** - Mermaid ER diagram source (rendered natively in GitHub)

## How It Works

The database documentation is automatically generated by GitHub Actions on every commit to `main` that modifies migration files.

### Workflow

1. **Trigger**: Push to `main` with changes in `src/main/resources/db/migration/**`
2. **Setup**: PostgreSQL container started, Flyway migrations executed
3. **Generation**:
   - Schema documentation extracted from live database
   - Mermaid ER diagram generated from schema metadata
4. **Commit**: Updated documentation committed back to repository

### Manual Generation

You can generate documentation locally:

```bash
# Ensure PostgreSQL is running
docker-compose up -d postgres

# Generate schema documentation
PGHOST=localhost PGPORT=5432 PGDATABASE=costify PGUSER=postgres PGPASSWORD=postgres \
  ./scripts/generate-schema-docs.sh

# Generate ER diagram
PGHOST=localhost PGPORT=5432 PGDATABASE=costify PGUSER=postgres PGPASSWORD=postgres \
  ./scripts/generate-er-diagram.sh
```

## Viewing Diagrams

### In GitHub
The Mermaid diagram is rendered natively in GitHub markdown viewers.

### Locally
- View Mermaid source in `database-er-diagram.mmd`
- Render Mermaid in VS Code with extensions like "Markdown Preview Mermaid Support"
- View the diagram directly in `database-schema.md` with any Mermaid-compatible markdown viewer

## CI Pipeline

The documentation pipeline runs in `.github/workflows/database-schema-docs.yml` and:
- Uses Java 25 and Maven for migrations
- Spins up PostgreSQL 16 for schema extraction
- Generates Mermaid ER diagrams from database metadata
- Commits results with `[skip ci]` to avoid infinite loops
